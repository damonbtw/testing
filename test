dx9.ShowConsole(false)

--// Real Chest ESP - @crossmyheart0551 ðŸ‘‘
local Lib = loadstring(dx9.Get("https://raw.githubusercontent.com/soupg/DXLibUI/main/main.lua"))()

local Window = Lib:CreateWindow({
    Title = "Real Chest ESP - @crossmyheart0551 ðŸ‘‘",
    Size = {500, 350},
    Resizable = false,
    ToggleKey = "[F5]",
    FooterMouseCoords = false,
    MainColor = {15, 15, 18},
    BackgroundColor = {10, 10, 12},
    AccentColor = {255, 215, 0},
    OutlineColor = {40, 20, 25},
    FontColor = {240, 240, 245}
})

local Tab = Window:AddTab("Chest ESP")
local MainBox = Tab:AddMiddleGroupbox("ESP Settings")

--// ESP Toggles
local espEnabled = MainBox:AddToggle({
    Text = "ESP Enabled",
    Default = true
})

local showFakeChests = MainBox:AddToggle({
    Text = "Show Fake Chests (Red)",
    Default = false
})

local showDistance = MainBox:AddToggle({
    Text = "Show Distance",
    Default = true
})

MainBox:AddBlank(5)

--// Color Pickers
local realChestColor = MainBox:AddColorPicker({
    Text = "Real Chest Color",
    Default = {255, 215, 0} -- Gold
})

local fakeChestColor = MainBox:AddColorPicker({
    Text = "Fake Chest Color",
    Default = {255, 50, 50} -- Red
})

MainBox:AddBlank(5)

--// Distance Slider
local distSlider = MainBox:AddSlider({
    Text = "Distance Limit",
    Min = 0,
    Max = 10000,
    Default = 5000,
    Rounding = 0,
    Suffix = " studs"
})

MainBox:AddBlank(5)
MainBox:AddBorder()
MainBox:AddBlank(3)
MainBox:AddLabel("Real chests = Folder type", {160, 160, 170})
MainBox:AddLabel("Fake chests = Non-folder type", {160, 160, 170})

--// Get ReplicatedStorage
local ReplicatedStorage = dx9.FindFirstChild(dx9.GetDatamodel(), "ReplicatedStorage")

--// Distance function
function GetDistanceFromPlayer(v)
    local lp = dx9.get_localplayer()
    if not lp then return 99999 end
    local v1 = lp.Position
    local a = (v1.x - v.x) ^ 2 + (v1.y - v.y) ^ 2 + (v1.z - v.z) ^ 2
    return math.floor(math.sqrt(a) + 0.5)
end

--// Check if object is a folder
function IsFolder(obj)
    local className = dx9.GetClassName(obj)
    return className == "Folder"
end

--// Draw ESP for chest
function DrawChestESP(chest, isReal)
    -- Look for HitBox part
    local hitbox = dx9.FindFirstChild(chest, "HitBox")
    
    if not hitbox then return end
    
    local position = dx9.GetPosition(hitbox)
    if not position then return end
    
    -- Check distance
    local dist = GetDistanceFromPlayer(position)
    if dist > distSlider.Value then return end
    
    -- Skip fake chests if disabled
    if not isReal and not showFakeChests.Value then return end
    
    -- Get color
    local color = isReal and realChestColor.Value or fakeChestColor.Value
    
    -- Calculate screen position
    local screenPos = dx9.WorldToScreen({position.x, position.y + 2, position.z})
    if not screenPos or screenPos.x <= 0 or screenPos.y <= 0 then return end
    
    -- Draw chest label
    local label = isReal and "âœ“ REAL CHEST" or "âœ— FAKE CHEST"
    local labelWidth = dx9.CalcTextWidth(label)
    
    -- Black outline for visibility
    for dx = -2, 2, 1 do
        for dy = -2, 2, 1 do
            if dx ~= 0 or dy ~= 0 then
                dx9.DrawString({screenPos.x - labelWidth/2 + dx, screenPos.y + dy}, {0, 0, 0}, label)
            end
        end
    end
    
    dx9.DrawString({screenPos.x - labelWidth/2, screenPos.y}, color, label)
    
    -- Draw distance
    if showDistance.Value then
        local distText = tostring(dist) .. " studs"
        local distWidth = dx9.CalcTextWidth(distText)
        dx9.DrawString({screenPos.x - distWidth/2, screenPos.y + 15}, color, distText)
    end
    
    -- Draw tracer for real chests
    if isReal then
        local screenW = dx9.size().width
        local screenH = dx9.size().height
        dx9.DrawLine({screenW / 2, screenH}, {screenPos.x, screenPos.y}, color)
    end
end}, label)
            end
        end
    end
    
    dx9.DrawString({screenPos.x - labelWidth/2, screenPos.y}, color, label)
    
    -- Draw distance
    if showDistance.Value then
        local distText = tostring(dist) .. " studs"
        local distWidth = dx9.CalcTextWidth(distText)
        dx9.DrawString({screenPos.x - distWidth/2, screenPos.y + 15}, color, distText)
    end
    
    -- Draw tracer for real chests
    if isReal then
        local screenW = dx9.size().width
        local screenH = dx9.size().height
        dx9.DrawLine({screenW / 2, screenH}, {screenPos.x, screenPos.y}, color)
    end
end

--// Scan for chests in ReplicatedStorage
function ScanForChests()
    if not ReplicatedStorage then return end
    
    -- Navigate: ReplicatedStorage > ArchemaraReplicatedStorage > StoredRooms
    local archemaraStorage = dx9.FindFirstChild(ReplicatedStorage, "ArchemaraReplicatedStorage")
    if not archemaraStorage then return end
    
    local storedRooms = dx9.FindFirstChild(archemaraStorage, "StoredRooms")
    if not storedRooms then return end
    
    local roomsList = dx9.GetChildren(storedRooms)
    if not roomsList then return end
    
    -- Loop through all rooms (Room1_1, Room2_6, etc.)
    for _, room in ipairs(roomsList) do
        -- Get Props folder
        local props = dx9.FindFirstChild(room, "Props")
        if props then
            -- Get Chests folder
            local chestsFolder = dx9.FindFirstChild(props, "Chests")
            if chestsFolder then
                -- Loop through all chests inside
                local chestsList = dx9.GetChildren(chestsFolder)
                if chestsList then
                    for _, chest in ipairs(chestsList) do
                        -- Check if this chest is a Folder (real) or not (fake)
                        local isRealChest = IsFolder(chest)
                        
                        -- Draw ESP for this chest
                        pcall(DrawChestESP, chest, isRealChest)
                    end
                end
            end
        end
    end
end

--// Main ESP Loop
coroutine.wrap(function()
    while true do
        if espEnabled.Value then
            pcall(ScanForChests)
        end
        
        dx9.Sleep(0)
    end
end)()

Lib:Notify("Chest ESP Loaded! ðŸ’°", 3)
Lib:Notify("Real = Gold, Fake = Red", 2)
