dx9.ShowConsole(false)

--// Load library
local Lib = loadstring(dx9.Get("https://raw.githubusercontent.com/damonbtw/WHATISASKID/refs/heads/main/skiddingwhattt.lua"))()

--// Create Window
local Window = Lib:CreateWindow({
    Title = "Chest ESP - @crossmyheart0551",
    Size = {500, 350},
    Resizable = false,
    ToggleKey = "[F5]",
    MainColor = {15, 15, 18},
    BackgroundColor = {10, 10, 12},
    AccentColor = {255, 215, 0},
    OutlineColor = {40, 20, 25},
    FontColor = {240, 240, 245}
})

local Tab = Window:AddTab("Chest ESP")
local MainBox = Tab:AddMiddleGroupbox("Settings")

local espEnabled = MainBox:AddToggle({Text = "ESP Enabled", Default = true})
local showFake = MainBox:AddToggle({Text = "Show Fake Chests", Default = false})
local showDist = MainBox:AddToggle({Text = "Show Distance", Default = true})
local showTracers = MainBox:AddToggle({Text = "Show Tracers", Default = true})

MainBox:AddBlank(5)

local realColor = MainBox:AddColorPicker({Text = "Real Chest", Default = {255, 215, 0}})
local fakeColor = MainBox:AddColorPicker({Text = "Fake Chest", Default = {255, 50, 50}})

MainBox:AddBlank(5)

local distSlider = MainBox:AddSlider({
    Text = "Max Distance",
    Min = 100,
    Max = 10000,
    Default = 5000,
    Rounding = 0
})

--// Get services
local dm = dx9.GetDatamodel()
local RS = dx9.FindFirstChild(dm, "ReplicatedStorage")

--// Functions
function GetDist(pos)
    local lp = dx9.get_localplayer()
    if not lp then return 99999 end
    local p = lp.Position
    return math.floor(math.sqrt((p.x-pos.x)^2 + (p.y-pos.y)^2 + (p.z-pos.z)^2))
end

function IsFolder(obj)
    if not obj then return false end
    -- Check if it has children but no position (characteristic of a Folder)
    local children = dx9.GetChildren(obj)
    local position = dx9.GetPosition(obj)
    -- Folders have children but no position
    return children ~= nil and #children > 0 and position == nil
end

function DrawChestESP(hitbox, isReal)
    if not hitbox then return end
    
    local pos = dx9.GetPosition(hitbox)
    if not pos then return end
    
    -- Calculate distance
    local dist = GetDist(pos)
    if dist > distSlider.Value then return end
    
    -- Skip fake chests if disabled
    if not isReal and not showFake.Value then return end
    
    -- Get color
    local col = isReal and realColor.Value or fakeColor.Value
    
    -- Convert world to screen
    local sp = dx9.WorldToScreen({pos.x, pos.y+2, pos.z})
    if not sp or sp.x <= 0 or sp.y <= 0 then return end
    
    -- Draw label
    local txt = isReal and "âœ“ REAL CHEST" or "âœ— FAKE CHEST"
    local w = dx9.CalcTextWidth(txt)
    
    -- Draw outline
    for x=-1,1 do
        for y=-1,1 do
            if x~=0 or y~=0 then
                dx9.DrawString({sp.x-w/2+x, sp.y+y}, {0,0,0}, txt)
            end
        end
    end
    
    -- Draw main text
    dx9.DrawString({sp.x-w/2, sp.y}, col, txt)
    
    -- Draw distance
    if showDist.Value then
        local dt = tostring(dist).." m"
        local dw = dx9.CalcTextWidth(dt)
        
        -- Outline
        for x=-1,1 do
            for y=-1,1 do
                if x~=0 or y~=0 then
                    dx9.DrawString({sp.x-dw/2+x, sp.y+15+y}, {0,0,0}, dt)
                end
            end
        end
        
        dx9.DrawString({sp.x-dw/2, sp.y+15}, col, dt)
    end
    
    -- Draw tracers (only for real chests)
    if showTracers.Value and isReal then
        local sw, sh = dx9.size().width, dx9.size().height
        dx9.DrawLine({sw/2, sh}, {sp.x, sp.y}, col)
    end
end

function ScanChests()
    if not RS then return end
    
    -- Navigate: ReplicatedStorage > ArchemaraReplicatedStorage
    local arch = dx9.FindFirstChild(RS, "ArchemaraReplicatedStorage")
    if not arch then return end
    
    -- > StoredRooms
    local storedRooms = dx9.FindFirstChild(arch, "StoredRooms")
    if not storedRooms then return end
    
    -- Get all rooms
    local rooms = dx9.GetChildren(storedRooms)
    if not rooms then return end
    
    -- Loop through each room (Room1_1, Room2_6, etc.)
    for _, room in ipairs(rooms) do
        -- > Props
        local props = dx9.FindFirstChild(room, "Props")
        if props then
            -- > Chests (this is the one we check if it's a Folder)
            local chestsObj = dx9.FindFirstChild(props, "Chests")
            if chestsObj then
                -- Check if "Chests" is a Folder (real) or not (fake)
                local isReal = IsFolder(chestsObj)
                
                -- > StandardChest > HitBox
                local standardChest = dx9.FindFirstChild(chestsObj, "StandardChest")
                if standardChest then
                    local hitbox = dx9.FindFirstChild(standardChest, "HitBox")
                    if hitbox then
                        pcall(DrawChestESP, hitbox, isReal)
                    end
                end
            end
        end
    end
end

--// Main ESP Loop
coroutine.wrap(function()
    while true do
        if espEnabled.Value then
            pcall(ScanChests)
        end
        dx9.Sleep(0)
    end
end)()

Lib:Notify("Chest ESP Loaded! ðŸ”¥", 3)
